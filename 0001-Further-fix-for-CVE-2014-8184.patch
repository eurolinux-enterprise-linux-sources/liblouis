From cf1cc90e08b88735c4f979199166876c6eac5a14 Mon Sep 17 00:00:00 2001
From: Samuel Thibault <samuel.thibault@ens-lyon.org>
Date: Fri, 10 Nov 2017 15:53:17 +0100
Subject: [PATCH] Further fix for CVE-2014-8184

The RedHat CVE-2014-8184 patch did not fix the potential buffer
overruns and missing trailing \0 from the strncpy call.
---
 liblouis/compileTranslationTable.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/liblouis/compileTranslationTable.c b/liblouis/compileTranslationTable.c
index 0c204b7a..0af46215 100644
--- a/liblouis/compileTranslationTable.c
+++ b/liblouis/compileTranslationTable.c
@@ -4521,6 +4521,8 @@ findTable (const char *tableName)
 	int listLength;
 	int currentListPos = 0;
 	listLength = strlen (pathList);
+	if (listLength >= MAXSTRING)
+	  listLength = MAXSTRING-1;
 	for (k = 0; k < listLength; k++)
 	  if (pathList[k] == ',')
 	    break;
@@ -4534,6 +4536,7 @@ findTable (const char *tableName)
 	  {			/* Compile a list of files */
 	    char path[MAXSTRING];
 	    strncpy (path, pathList, k);
+	    path[k] = 0;
 	    snprintf (trialPath, MAXSTRING-1, "%s%s%s", path, pathEnd, tableName);
 	    currentListPos = k + 1;
 	    if ((tableFile = fopen (trialPath, "rb")))
@@ -4544,6 +4547,7 @@ findTable (const char *tableName)
 		  if (pathList[k] == ',')
 		    break;
 		strncpy (path, &pathList[currentListPos], k - currentListPos);
+		path[k - currentListPos] = 0;
 		snprintf (trialPath, MAXSTRING-1, "%s%s%s", path, pathEnd, tableName);
 		if ((tableFile = fopen (trialPath, "rb")))
 		  currentListPos = k + 1;
-- 
2.14.2

